# =============================================================================
# Azure IPAM - Ingress Configuration
# Routes external traffic to frontend and API services
# =============================================================================
# Supports multiple ingress controllers:
#   - nginx-ingress
#   - traefik
#   - Azure Application Gateway (with AGIC)
#
# Uncomment the appropriate annotations for your ingress controller
# =============================================================================
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: azure-ipam-ingress
  namespace: azure-ipam
  labels:
    app.kubernetes.io/name: azure-ipam
    app.kubernetes.io/component: ingress
  annotations:
    # === Nginx Ingress Controller ===
    kubernetes.io/ingress.class: nginx
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/proxy-body-size: "10m"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "60"
    
    # === Enable CORS for API ===
    nginx.ingress.kubernetes.io/enable-cors: "true"
    nginx.ingress.kubernetes.io/cors-allow-methods: "GET, POST, PUT, DELETE, OPTIONS"
    nginx.ingress.kubernetes.io/cors-allow-headers: "Authorization, Content-Type"
    
    # === TLS with cert-manager (uncomment if using cert-manager) ===
    # cert-manager.io/cluster-issuer: "letsencrypt-prod"
    
    # === Azure Application Gateway Ingress (uncomment if using AGIC) ===
    # kubernetes.io/ingress.class: azure/application-gateway
    # appgw.ingress.kubernetes.io/ssl-redirect: "true"
    # appgw.ingress.kubernetes.io/backend-path-prefix: "/"
spec:
  # TLS configuration (uncomment and update for HTTPS)
  # tls:
  #   - hosts:
  #       - ipam.yourdomain.com
  #     secretName: azure-ipam-tls
  rules:
    - host: ""  # Replace with your domain or leave empty for IP-based access
      http:
        paths:
          # API routes
          - path: /api
            pathType: Prefix
            backend:
              service:
                name: azure-ipam-api
                port:
                  number: 7071
          # Frontend routes (catch-all)
          - path: /
            pathType: Prefix
            backend:
              service:
                name: azure-ipam-frontend
                port:
                  number: 80
